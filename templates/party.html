$def with (d)

<!--
<iframe id="map" src="$maproot/kmap.html">
</iframe>
-->

$code:
    ymax = max(p.contested for p in d.performance)
    if ymax > 400:
        ystep = 100
    elif ymax > 200:
        ystep = 50
    elif ymax > 100:
        ystep = 25
    elif ymax > 50:
        ystep = 10
    elif ymax > 20:
        ystep = 5
    else:
        ystep = 2
        
    ymax = ystep * (1 + ymax/ystep)
    
    chart = GroupedVerticalBarChart(400, 200, y_range=(0, ymax))
    chart.set_bar_width(10)
    chart.add_data([p.contested for p in d.performance][::-1])
    chart.add_data([p.won for p in d.performance][::-1])
    chart.set_legend(["Contested", "Won"])
    chart.set_colours(['00ff00', 'ff0000'])
    chart.set_axis_labels("x", [p.year for p in d.performance][::-1])
    chart.set_axis_labels("y", range(0, ymax+1, ystep))

<!-- Facts -->
<div id="facts">
<h2>$d.name</h2>

<table class="infoTable">
    <tr class="header">
        <th>Year</th>
        <th>Contested</th>
        <th>Won</th>
        <th></th>
    </tr>
    $for p in d.performance:
        <tr class="$loop.parity">
            <td class="result">$p.year</td>
            <td class="result">$p.contested</td>
            <td class="result">$p.won</td>
            <td rowspan="$len(d.performance)">
            $if loop.first:
                <img src="$chart.get_url()"/>
            </td>
        </tr>
</table>

</div>
<!-- Facts end -->


<!-- Map -->
<div id="map">
	<iframe id="map" src="$maproot/kmap.html?w=350&h=500"></iframe>
<div class="disclaimer">Map provided by <a href="http://www.gslab.com/">GS Lab</a></div>
</div>
<!-- Map ends -->
